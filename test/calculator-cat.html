<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>bogbowl — คำนวณแมว</title>

  <!-- Google Font: Kanit (มีทั้งตัวตรงและตัวเอียง) -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,300;0,400;0,600;0,700;1,300;1,400;1,700&display=swap" rel="stylesheet">


  <!-- CSS หลัก -->
  <link rel="stylesheet" href="assets/css/styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">
  

  <script src="assets/js/app.js" defer></script>
</body>
</html>

</head>
<body class="page-calculator page-cat">
  <!-- Header -->
  <header class="site-header">
    <div class="nav-bar">
      <div class="container nav">
        <a class="logo" href="index.html" aria-label="หน้าแรก bogbowl">
          <img src="assets/img/LOGO BOGBOWL.png" alt="โลโก้ bogbowl" />
        </a>


         <!-- ✅ ปุ่มอยู่ข้างใน .container.nav เท่านั้น -->
        <button id="nav-toggle" class="nav-toggle" aria-label="เปิดเมนู" aria-expanded="false">
          <span class="nav-toggle-bar"></span>
          <span class="nav-toggle-bar"></span>
          <span class="nav-toggle-bar"></span>
        </button>

        
        <nav class="nav-menu" id="nav-menu" aria-label="เมนูหลัก">
          <ul>
            <li><a href="index.html">หน้าหลัก</a></li>
            <li><a href="about.html">เกี่ยวกับ</a></li>
            <li><a href="menu.html">เมนูอาหาร</a></li>
            <li><a class="is-active" href="calculator.html">คำนวณความต้องการ</a></li>
            <li><a href="faq.html">FAQ</a></li>
            <li><a class="btn btn-orange" href="order.html">สั่งซื้อ</a></li>
          </ul>
        </nav>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <!-- ใช้ calc-dog ร่วมกับ calc-cat เพื่อให้ CSS เดิมของคุณทำงานทันที -->
  <main id="main" class="calc-dog calc-cat with-fixed-header">
    <section class="page-head container">
      <nav class="breadcrumb">
        <a href="calculator.html">หน้าแรกคำนวณ</a>
        <span>/</span>
        <span>แมว</span>
      </nav>
      <h1 class="page-title">คำนวณเมนูแบบเลือกตักเอง — <span class="tone-blue">แมว</span></h1>
      <p class="page-sub">กรอกน้ำหนัก เลือกช่วงอายุ/กิจกรรม </p>
    </section>

    <section class="container layout-3col">
      <!-- LEFT: ตั้งค่าพื้นฐาน -->
      <aside class="panel">
        <h2 class="panel-title">ข้อมูลพื้นฐาน</h2>

        <label class="field">
          <span class="field-label">น้ำหนักแมว (Cat's Weight) (kg.)</span>
          <input id="weight" type="number" min="0" step="0.1" class="input" placeholder="เช่น 4.5">
        </label>

        <label class="field">
          <span class="field-label">อายุแมว (Cat's Age)</span>
          <select id="ageKey" class="select">
            <option value="1_2m">1 - 2 เดือน</option>
            <option value="3_4m">3 - 4 เดือน</option>
            <option value="5_6m">5 - 6 เดือน</option>
            <option value="7_9m">7 - 9 เดือน</option>
            <option value="9_12m">9 - 12 เดือน</option>
            <option value="1_3y" selected>1 - 3 ขวบ</option>
            <option value="4_7y">4 - 7 ขวบ</option>
            <option value="8y_up">มากกว่า 8 ขวบ</option>
          </select>
        </label>

        <label class="field">
          <span class="field-label">ระดับกิจกรรม/ความแอคทีฟ (Cat's activity)</span>
          <select id="activity" class="select">
            <option value="low">กิจกรรมน้อย/วิ่งเล่นน้อย / Low</option>
            <option value="mod" selected>แอคทีฟปานกลาง/วิ่งเล่นบ้าง / Moderate</option>
            <option value="high">แอคทีฟมาก/วิ่งเล่นบ่อย / High</option>
          </select>
        </label>

        <!-- เป้าหมายต่อวัน -->
        <div class="goal-box">
          <div class="goal-line">
            ปริมาณแนะนำ (ต่อวัน) ≈ <b id="target-grams">—</b> g/day
          </div>
          <div class="goal-sub">
            พลังงานแนะนำ (ต่อวัน) ≈ <span id="target-mer">—</span> kcal/day
          </div>
        </div>

        <p class="goal-note">
          *หากมีความกังวลด้านสุขภาพเพิ่มเติม เช่น โรคไต/เบาหวาน แนะนำเลือกสูตรเฉพาะของทางร้านค่ะ
        </p>
      </aside>

      <!-- MIDDLE: เลือกวัตถุดิบ (ใช้ชุดเดียวกับสุนัขได้) -->
      <section class="panel">
        <h3 class="panel-title">เลือกวัตถุดิบ</h3>

        <div class="ing-grid" id="ingredient-list">
          <!-- 1. อกไก่ไร้หนัง -->
          <article class="ing-card" data-name="อกไก่ไร้หนัง">
            <header class="ing-head">
              <div>
                <div class="ing-name">อกไก่ไร้หนัง</div>
                <div class="ing-unit">หน่วย: กรัม</div>
              </div>
              <span class="ing-amount" data-show-grams>0 g</span>
            </header>
            <div class="ing-controls">
              <button class="ctrl" data-step="-10">−</button>
              <input class="ctrl-input" type="number" inputmode="decimal" placeholder="กรัม">
              <button class="ctrl" data-step="+10">+</button>
            </div>
            <footer class="ing-meta">
              <span class="badge warn">พลังงาน <span data-kcal>0</span> kcal</span>
              <span class="badge">≈ ราคา <span data-price>0</span> บาท</span>
            </footer>
          </article>

          <!-- 2. ปลาทู -->
          <article class="ing-card" data-name="ปลาทู">
            <header class="ing-head">
              <div>
                <div class="ing-name">ปลาทู</div>
                <div class="ing-unit">หน่วย: กรัม</div>
              </div>
              <span class="ing-amount" data-show-grams>0 g</span>
            </header>
            <div class="ing-controls">
              <button class="ctrl" data-step="-10">−</button>
              <input class="ctrl-input" type="number" placeholder="กรัม">
              <button class="ctrl" data-step="+10">+</button>
            </div>
            <footer class="ing-meta">
              <span class="badge warn">พลังงาน <span data-kcal>0</span> kcal</span>
              <span class="badge">≈ ราคา <span data-price>0</span> บาท</span>
            </footer>
          </article>

          <!-- 3. ไข่ต้ม (หน่วยเป็นฟอง ~50g) -->
          <article class="ing-card" data-name="ไข่ต้ม" data-grams-per-unit="50">
            <header class="ing-head">
              <div>
                <div class="ing-name">ไข่ต้ม</div>
                <div class="ing-unit">หน่วย: ฟอง (≈ 50 g/ฟอง)</div>
              </div>
              <span class="ing-amount" data-show-grams>0 g</span>
            </header>
            <div class="ing-controls">
              <button class="ctrl" data-step="-1">−</button>
              <input class="ctrl-input" type="number" placeholder="ฟอง">
              <button class="ctrl" data-step="+1">+</button>
            </div>
            <footer class="ing-meta">
              <span class="badge warn">พลังงาน <span data-kcal>0</span> kcal</span>
              <span class="badge">≈ ราคา <span data-price>0</span> บาท</span>
            </footer>
          </article>

          <!-- 4. ฟักทองต้ม -->
          <article class="ing-card" data-name="ฟักทองต้ม">
            <header class="ing-head">
              <div>
                <div class="ing-name">ฟักทองต้ม</div>
                <div class="ing-unit">หน่วย: กรัม</div>
              </div>
              <span class="ing-amount" data-show-grams>0 g</span>
            </header>
            <div class="ing-controls">
              <button class="ctrl" data-step="-10">−</button>
              <input class="ctrl-input" type="number" placeholder="กรัม">
              <button class="ctrl" data-step="+10">+</button>
            </div>
            <footer class="ing-meta">
              <span class="badge warn">พลังงาน <span data-kcal>0</span> kcal</span>
              <span class="badge">≈ ราคา <span data-price>0</span> บาท</span>
            </footer>
          </article>

          <!-- 5. ข้าวสวย -->
          <article class="ing-card" data-name="ข้าวสวย">
            <header class="ing-head">
              <div>
                <div class="ing-name">ข้าวสวย</div>
                <div class="ing-unit">หน่วย: กรัม</div>
              </div>
              <span class="ing-amount" data-show-grams>0 g</span>
            </header>
            <div class="ing-controls">
              <button class="ctrl" data-step="-10">−</button>
              <input class="ctrl-input" type="number" placeholder="กรัม">
              <button class="ctrl" data-step="+10">+</button>
            </div>
            <footer class="ing-meta">
              <span class="badge warn">พลังงาน <span data-kcal>0</span> kcal</span>
              <span class="badge">≈ ราคา <span data-price>0</span> บาท</span>
            </footer>
          </article>

          <!-- 6. ตับไก่ -->
          <article class="ing-card" data-name="ตับไก่">
            <header class="ing-head">
              <div>
                <div class="ing-name">ตับไก่</div>
                <div class="ing-unit">หน่วย: กรัม</div>
              </div>
              <span class="ing-amount" data-show-grams>0 g</span>
            </header>
            <div class="ing-controls">
              <button class="ctrl" data-step="-10">−</button>
              <input class="ctrl-input" type="number" placeholder="กรัม">
              <button class="ctrl" data-step="+10">+</button>
            </div>
            <footer class="ing-meta">
              <span class="badge warn">พลังงาน <span data-kcal>0</span> kcal</span>
              <span class="badge">≈ ราคา <span data-price>0</span> บาท</span>
            </footer>
          </article>

          <!-- 7. หัวใจไก่ -->
          <article class="ing-card" data-name="หัวใจไก่">
            <header class="ing-head">
              <div>
                <div class="ing-name">หัวใจไก่</div>
                <div class="ing-unit">หน่วย: กรัม</div>
              </div>
              <span class="ing-amount" data-show-grams>0 g</span>
            </header>
            <div class="ing-controls">
              <button class="ctrl" data-step="-10">−</button>
              <input class="ctrl-input" type="number" placeholder="กรัม">
              <button class="ctrl" data-step="+10">+</button>
            </div>
            <footer class="ing-meta">
              <span class="badge warn">พลังงาน <span data-kcal>0</span> kcal</span>
              <span class="badge">≈ ราคา <span data-price>0</span> บาท</span>
            </footer>
          </article>
        </div>
      </section>

      <!-- RIGHT: สรุปผล -->
      <aside class="panel sticky" id="summary-box">
        <h3 class="panel-title">สรุปผล</h3>

        <div class="sum-row" data-unit="g">
          <div class="sum-label">ปริมาณรวม <span id="sum-weight">0</span> / <span id="sum-target">0</span> g</div>
          <div class="progress"><span class="bar"></span></div>
          <div class="sum-badge" id="sum-weight-diff"></div>
        </div>

        <div class="sum-row" data-unit="kcal">
          <div class="sum-label">พลังงาน <span id="sum-kcal">0</span> / <span id="sum-kcal-target">0</span> kcal</div>
          <div class="progress"><span class="bar"></span></div>
          <div class="sum-badge" id="sum-kcal-diff"></div>
        </div>

        <div class="divider"></div>

        <div class="sum-row" data-unit="g">
          <div class="sum-mini">
            <span>โปรตีน</span>
            <span><b id="sum-protein">0</b> / <span id="target-protein">0</span> g</span>
          </div>
          <div class="progress small"><span class="bar"></span></div>
          <div class="sum-badge" id="sum-protein-diff"></div>
        </div>

        <div class="sum-row" data-unit="g">
          <div class="sum-mini">
            <span>ไขมัน</span>
            <span><b id="sum-fat">0</b> / <span id="target-fat">0</span> g</span>
          </div>
          <div class="progress small"><span class="bar"></span></div>
          <div class="sum-badge" id="sum-fat-diff"></div>
        </div>

        <div class="sum-row" data-unit="g">
          <div class="sum-mini">
            <span>คาร์บ</span>
            <span><b id="sum-carb">0</b> / <span id="target-carb">0</span> g</span>
          </div>
          <div class="progress small"><span class="bar"></span></div>
          <div class="sum-badge" id="sum-carb-diff"></div>
        </div>

        <div class="sum-row" data-unit="mg">
          <div class="sum-mini">
            <span>โซเดียม</span>
            <span><b id="sum-sodium">0</b> / <span id="target-sodium">0</span> mg</span>
          </div>
          <div class="progress small"><span class="bar"></span></div>
          <div class="sum-badge" id="sum-sodium-diff"></div>
        </div>

        <div class="divider"></div>

        <div class="sum-price">
          <span>ราคาโดยประมาณ</span>
          <b class="price" id="sum-price">0.00 บาท</b>
        </div>

        <div class="sum-actions">
          <a href="order.html" class="sum-order">สั่งซื้อ</a>
        </div>

        <div class="tips">
          <h4 class="tips-title">คำแนะนำอัตโนมัติ</h4>
          <ul class="tips-list">
            <li id="tip1" class="tip-item">—</li>
            <li id="tip2" class="tip-item">—</li>
            <li id="tip3" class="tip-item">—</li>
          </ul>
        </div>
      </aside>
    </section>

    <footer class="container page-foot">
      © <script>document.write(new Date().getFullYear())</script> Feeding Focus — HO g/kg + RER guard
    </footer>
  </main>

  <!-- SCRIPT: คำนวณของแมว  -->
  <script>
  (() => {
    'use strict';

    /* ====== DATA: CAT ONLY ====== */
    const CAT_GPK = {
      "1_2m":  { low: 80, mod: 100, high: 120 },
      "3_4m":  { low: 64, mod: 80,  high: 96 },
      "5_6m":  { low: 56, mod: 70,  high: 84 },
      "7_9m":  { low: 48, mod: 60,  high: 72 },
      "9_12m": { low: 40, mod: 50,  high: 60 },
      "1_3y":  { low: 24, mod: 30,  high: 36 },
      "4_7y":  { low: 20, mod: 25,  high: 30 },
      "8y_up": { low: 16, mod: 20,  high: 24 },
    };
    const ACTIVITY_FACTOR = { low: 1.0, mod: 1.2, high: 1.4 };

    /* พื้นฐานแมว (จะ scale ตาม MER) — ทำให้ sodium = ~0.74 mg/kcal */
    const BASE_MACROS = {
      cat: { energy: 200, protein: 20, fat: 8.9, carb: 10, sodium: (200/1000)*740 }
    };

    /* ====== Ingredients (ใช้ชุดเดียวกับหน้าสุนัข) ====== */
    const INGREDIENTS = [
      { name: 'อกไก่ไร้หนัง', calPerGram: 1.65, protein: 0.31,  fat: 0.036, carb: 0,     sodium: 0.74, iron: 0.007, unit: 'กรัม' },
      { name: 'ปลาทู',       calPerGram: 1.49, protein: 0.25,  fat: 0.046, carb: 0,     sodium: 0.89, iron: 0.015, unit: 'กรัม' },
      { name: 'ไข่ต้ม',       calPerGram: 1.55, protein: 0.13,  fat: 0.11,  carb: 0.01,  sodium: 1.24, iron: 0.012, unit: 'ฟอง', gramsPerUnit: 50 },
      { name: 'ฟักทองต้ม',   calPerGram: 0.20, protein: 0.007, fat: 0.001, carb: 0.049, sodium: 0.01, iron: 0.008, unit: 'กรัม' },
      { name: 'ข้าวสวย',     calPerGram: 1.30, protein: 0.027, fat: 0.003, carb: 0.282, sodium: 0.01, iron: 0.002, unit: 'กรัม' },
      { name: 'ตับไก่',      calPerGram: 1.67, protein: 0.245, fat: 0.065, carb: 0.009, sodium: 0.76, iron: 0.116, unit: 'กรัม' },
      { name: 'หัวใจไก่',    calPerGram: 1.85, protein: 0.26,  fat: 0.08,  carb: 0.001, sodium: 0.48, iron: 0.09,  unit: 'กรัม' },
    ];
    const PRICE_PER_100 = 29;

    /* ====== Utils ====== */
    const $  = (s, r=document) => r.querySelector(s);
    const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));
    const num = v => isFinite(parseFloat(v)) ? parseFloat(v) : 0;
    const clamp = (v, lo, hi) => Math.max(lo, Math.min(hi, v));
    const calcRER = kg => { const w = Math.max(0, num(kg)); return w ? 70 * Math.pow(w, 0.75) : 0; };
    const toPct = (val, tgt) => tgt>0 ? clamp((val/tgt)*100, 0, 100) : 0;

    function computeTotals(selected){
      const init = { calories:0, protein:0, fat:0, carb:0, sodium:0, iron:0, weight:0 };
      return Object.entries(selected).reduce((acc,[name,value])=>{
        const ing = INGREDIENTS.find(i=>i.name===name);
        if(!ing || !value) return acc;
        const grams = ing.gramsPerUnit ? value*(ing.gramsPerUnit||0) : value;
        acc.calories += ing.calPerGram*grams;
        acc.protein  += ing.protein*grams;
        acc.fat      += ing.fat*grams;
        acc.carb     += ing.carb*grams;
        acc.sodium   += ing.sodium*grams;
        acc.iron     += ing.iron*grams;
        acc.weight   += grams;
        return acc;
      }, init);
    }

    /* ====== DOM ====== */
    const elWeight   = $('#weight');
    const elAge      = $('#ageKey');
    const elActivity = $('#activity');
    const elTargetG  = $('#target-grams');
    const elTargetMER= $('#target-mer');

    const sum = {
      weight: $('#sum-weight'), targetWeight: $('#sum-target'),
      kcal:   $('#sum-kcal'),   targetKcal:   $('#sum-kcal-target'),
      protein: $('#sum-protein'), targetProtein: $('#target-protein'),
      fat:     $('#sum-fat'),     targetFat:     $('#target-fat'),
      carb:    $('#sum-carb'),    targetCarb:    $('#target-carb'),
      sodium:  $('#sum-sodium'),  targetSodium:  $('#target-sodium'),
      price:   $('#sum-price'),
      rows: $$('.sum-row'),
    };
    const tipsEls = [$('#tip1'), $('#tip2'), $('#tip3')];

    const ingCards = $$('#ingredient-list .ing-card');
    const selected = {}; // { ชื่อวัตถุดิบ: จำนวน(กรัม/ฟอง) }

    /* ====== Targets (CAT) ====== */
    function calculateTargets(){
      const w = num(elWeight.value);
      const ageKey = elAge.value;
      const act = elActivity.value;

      const gpk = (CAT_GPK[ageKey] && CAT_GPK[ageKey][act]) ? CAT_GPK[ageKey][act] : 0;
      const targetGrams = w>0 ? w * gpk : 0;

      const rer = calcRER(w);
      const mer = rer * (ACTIVITY_FACTOR[act] || 1);
      const base = BASE_MACROS.cat;
      const scale = base.energy>0 ? (mer / base.energy) : 0;

      const targets = {
        energy: mer,
        protein: base.protein * scale,
        fat: base.fat * scale,
        carb: base.carb * scale,
        sodium: base.sodium * scale, // = ~0.74 mg/kcal
        grams: targetGrams,
      };

      if (elTargetG)   elTargetG.textContent   = targetGrams>0 ? targetGrams.toFixed(0) : '—';
      if (elTargetMER) elTargetMER.textContent = mer>0 ? mer.toFixed(0) : '0';
      return targets;
    }

    /* ====== Card UI sync ====== */
    function syncCardUI(card){
      const name = card.dataset.name;
      const gpu  = num(card.dataset.gramsPerUnit);

      const input = $('.ctrl-input', card);
      const raw   = num(input.value);
      const grams = gpu ? raw * gpu : raw;

      const ing = INGREDIENTS.find(i=>i.name===name);
      const kcal  = grams * (ing?.calPerGram || 0);
      const price = grams>0 ? (grams/100)*PRICE_PER_100 : 0;

      const showGrams = $('[data-show-grams]', card);
      const kcalSpan  = $('[data-kcal]', card);
      const priceSpan = $('[data-price]', card);

      if (showGrams) showGrams.textContent = grams>0 ? `${grams.toFixed(0)} g` : '0 g';
      if (kcalSpan)  kcalSpan.textContent  = (Math.round(kcal * 10) / 10).toFixed(1);
      if (priceSpan) priceSpan.textContent = price.toFixed(2);

      selected[name] = raw>0 ? raw : 0;
    }

    /* ====== Progress + badge colors ====== */
    function setProgress(rowEl, value, target){
      const bar = $('.progress .bar', rowEl);
      if (bar) bar.style.width = `${toPct(value, target)}%`;

      const unit = rowEl.dataset.unit || '';
      const diff = value - target;
      const badge = $('.sum-badge', rowEl);
      if (badge){
        if (Math.abs(diff) < 0.01)      badge.textContent = 'พอดีเป๊ะ';
        else if (diff > 0)              badge.textContent = `เกิน ${Math.abs(diff).toFixed(1)} ${unit}`;
        else                            badge.textContent = `ขาด ${Math.abs(diff).toFixed(1)} ${unit}`;
      }

      rowEl.classList.remove('is-ok','is-warn','is-bad');
      if (!(target > 0)) { rowEl.classList.add('is-ok'); return; }
      const tol = 0.02;
      const ratio = value / target;
      if (ratio < 1 - tol)      rowEl.classList.add('is-bad');   // ขาด = แดง
      else if (ratio > 1 + tol) rowEl.classList.add('is-warn');  // เกิน = ส้ม
      else                      rowEl.classList.add('is-ok');    // พอดี = เขียว
    }

    /* ====== Render ====== */
    function renderTotals(targets, totals){
      sum.weight.textContent = totals.weight.toFixed(0);
      sum.targetWeight.textContent = targets.grams.toFixed(0);
      sum.kcal.textContent   = totals.calories.toFixed(0);
      sum.targetKcal.textContent = targets.energy.toFixed(0);

      setProgress(sum.rows[0], totals.weight, targets.grams);   sum.rows[0].dataset.unit = 'g';
      setProgress(sum.rows[1], totals.calories, targets.energy); sum.rows[1].dataset.unit = 'kcal';

      sum.protein.textContent = totals.protein.toFixed(1);
      sum.targetProtein.textContent = targets.protein.toFixed(1);
      setProgress(sum.rows[2], totals.protein, targets.protein); sum.rows[2].dataset.unit = 'g';

      sum.fat.textContent = totals.fat.toFixed(1);
      sum.targetFat.textContent = targets.fat.toFixed(1);
      setProgress(sum.rows[3], totals.fat, targets.fat); sum.rows[3].dataset.unit = 'g';

      sum.carb.textContent = totals.carb.toFixed(1);
      sum.targetCarb.textContent = targets.carb.toFixed(1);
      setProgress(sum.rows[4], totals.carb, targets.carb); sum.rows[4].dataset.unit = 'g';

      sum.sodium.textContent = totals.sodium.toFixed(0);
      sum.targetSodium.textContent = targets.sodium.toFixed(0);
      setProgress(sum.rows[5], totals.sodium, targets.sodium); sum.rows[5].dataset.unit = 'mg';

      const totalPrice = (totals.weight/100)*PRICE_PER_100;
      if (sum.price) sum.price.textContent = `${totalPrice.toFixed(2)} บาท`;

      const tips = [];
      if (totals.weight < targets.grams*0.95) tips.push('น้ำหนักรวมยังขาดจากเป้า ลองเพิ่มโปรตีนไม่ติดมัน เช่น อกไก่ หรือ ปลาทู');
      if (totals.calories > targets.energy*1.2) tips.push(`พลังงานเกิน ${(totals.calories/targets.energy*100-100).toFixed(0)}% ลดคาร์บ (ข้าว) หรือเพิ่มโปรตีนไม่ติดมัน`);
      if (totals.protein < targets.protein*0.9) tips.push(`โปรตีนยังขาด ~${(targets.protein - totals.protein).toFixed(1)} g เพิ่ม อกไก่ หรือ ปลาทู`);
      if (totals.fat < targets.fat*0.9) tips.push(`ไขมันยังขาด ~${(targets.fat - totals.fat).toFixed(1)} g เพิ่ม ไข่ต้ม หรือ ตับไก่`);
      if (totals.carb < targets.carb*0.9) tips.push(`คาร์บยังขาด ~${(targets.carb - totals.carb).toFixed(1)} g เพิ่ม ข้าวสวย หรือ ฟักทองต้ม`);
      if (!tips.length && targets.energy>0 && targets.grams>0) tips.push('เยี่ยม! ปริมาณรวมและพลังงานใกล้เคียงเป้าหมายแล้ว ✅');

      tipsEls.forEach((el,i)=> el && (el.textContent = tips[i] || '—'));
    }

    function recalcAll(){
      ingCards.forEach(syncCardUI);
      const targets = calculateTargets();
      const totals  = computeTotals(selected);
      renderTotals(targets, totals);
    }

    /* ====== Events ====== */
    if (elWeight)   elWeight.addEventListener('input', recalcAll);
    if (elAge)      elAge.addEventListener('change', recalcAll);
    if (elActivity) elActivity.addEventListener('change', recalcAll);

    ingCards.forEach(card=>{
      const gpu   = num(card.dataset.gramsPerUnit);
      const input = $('.ctrl-input', card);

      const btnMinus = $('.ctrl[data-step^="-"]', card);
      if (btnMinus) btnMinus.addEventListener('click', ()=>{
        const step = num(btnMinus.dataset.step) || (gpu? -1 : -10);
        input.value = Math.max(0, num(input.value) + step);
        syncCardUI(card); recalcAll();
      });

      const btnPlus = $('.ctrl[data-step^="+"]', card);
      if (btnPlus) btnPlus.addEventListener('click', ()=>{
        const step = num(btnPlus.dataset.step) || (gpu? 1 : 10);
        input.value = Math.max(0, num(input.value) + step);
        syncCardUI(card); recalcAll();
      });

      if (input) input.addEventListener('input', ()=>{ syncCardUI(card); recalcAll(); });
    });

    window.addEventListener('DOMContentLoaded', recalcAll);
  })();
  </script>
</body>
</html>
